{block content}
<div class="container">
  <h1>{$title}</h1>

  {if $successMessage}
    <div class="alert alert-success">{$successMessage|noescape}</div>
  {/if}
  {if $errorMessage}
    <div class="alert alert-danger">{$errorMessage|noescape}</div>
  {/if}

  <form method="POST" action="/mfa-test">

    <div class="form-group">
      <label for="service">Select Service:</label>
      <select name="service" id="service" class="form-control" required>
        <option value="email">Email</option>
        <option value="sms">SMS</option>
        <option value="authenticator">Authenticator App</option>
      </select>
    </div>

    <div id="sms-email-section">
      <div class="form-group">
        <label for="recipient">Recipient (Email or E.164 phone):</label>
        <input type="text"
               name="recipient"
               id="recipient"
               class="form-control"
               placeholder="test@example.com or +14508087148"
               required>
      </div>
      <div class="form-group form-check">
        <input type="checkbox"
               name="use_generated_code"
               id="use_generated_code"
               class="form-check-input">
        <label for="use_generated_code" class="form-check-label">
          Use Generated MFA Code
        </label>
      </div>
      <div class="form-group">
        <label for="custom_body">Custom Message (if not using generated code):</label>
        <textarea name="custom_body"
                  id="custom_body"
                  class="form-control"
                  rows="3"
                  placeholder="Enter your custom message"></textarea>
      </div>
    </div>

    <div id="authenticator-section" style="display:none;">
      <div class="form-group text-center">
        <label>Scan this QR code:</label>
        <iframe src="/verify/qrcode"
                frameborder="0"
                scrolling="no"
                style="max-width:250px; height:250px; border:none;"
                class="mx-auto d-block">
        </iframe>
      </div>
      <div class="form-group">
        <label for="code">Enter 6â€‘digit code:</label>
        <input type="text"
               name="code"
               id="code"
               class="form-control"
               required>
      </div>
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</div>

<script nonce="{$nonce}">
  document.addEventListener('DOMContentLoaded', function(){
    const serviceSel = document.getElementById('service');
    const smsSec = document.getElementById('sms-email-section');
    const authSec = document.getElementById('authenticator-section');

    const smsFields  = smsSec.querySelectorAll('input, textarea');
    const authFields = authSec.querySelectorAll('input, textarea');

    function toggleSection(){
      if (serviceSel.value === 'authenticator') {
        smsSec.style.display  = 'none';
        smsFields.forEach(f => { f.disabled = true; f.required = false; });
        authSec.style.display = 'block';
        authFields.forEach(f => { f.disabled = false; });
      } else {
        smsSec.style.display  = 'block';
        smsFields.forEach(f => { 
          f.disabled = false; 
          if (f.name === 'recipient') f.required = true;
        });
        authSec.style.display = 'none';
        authFields.forEach(f => { f.disabled = true; f.required = false; });
      }
    }

    serviceSel.addEventListener('change', toggleSection);
    toggleSection();
  });
</script>
{/block}
